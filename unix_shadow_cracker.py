###################################################
# Feed in /etc/shadow and dictionary file         #
# to attempt brute-force cracking.                #
# Author: Matt Sanderson                          #
# Date: 2019-07-17                                #
###################################################

#!/usr/bin/env python

import sys
from passlib.hash import md5_crypt, sha256_crypt, sha512_crypt

hashTypes = {'MD5': '1', 'Blowfish': '2a', 'Blowfish': '2y', 'SHA-256': '5', 'SHA-512': '6'}

def crackPass(fullHash, algo, salt, wordList):
    dictFile = open(wordList, 'r')

    for word in dictFile.readlines():
        word = word.strip('\n')
        if algo == hashTypes['MD5']:
            if md5_crypt.using(salt=salt, rounds=5000).verify(word, fullHash):
                print("[+] Found Password: "+word+"\n")
                return
        if algo == hashTypes['SHA-256']:
            if sha256_crypt.using(salt=salt, rounds=5000).verify(word, fullHash):
                print("[+] Found Password: "+word+"\n")
                return
        if algo == hashTypes['SHA-512']:
            if sha512_crypt.using(salt=salt, rounds=5000).verify(word, fullHash):
                print("[+] Found Password: "+word+"\n")
                return
    print("[-] Password Not Found.\n")
    return

def main():
    passFile = sys.argv[1]
    wordList = sys.argv[2]
    passwords = open(passFile, 'r')
    for line in passwords.readlines():
        if ":" in line:
            user = line.split(':')[0]
            fullHash = line.split(':')[1] # $id$salt$hash
            algo, salt, cryptPass = line.split('$')[1:]
            print("[*] Cracking password for: "+user)
            crackPass(fullHash, algo, salt, wordList)

if __name__ == "__main__":
    main()
